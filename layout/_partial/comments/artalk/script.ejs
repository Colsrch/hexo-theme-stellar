<script>
  function load_artalk() {
    if (!document.querySelectorAll("#artalk_container")[0]) return;
    utils.css('<%- theme.comments.artalk.css %>');
    utils.js('<%- theme.comments.artalk.js %>', {defer: true}).then(function () {
      const el = document.getElementById("artalk_container");
      var path = el.getAttribute('comment_id');
      if (!path) {
        path = decodeURI(window.location.pathname);
      }
      var artalk = Artalk.init({
        el: '#artalk_container',
        pageKey: path,
        pageTitle: '<%= page.title %>',
        server: '<%= theme.comments.artalk.server %>',
        placeholder: '<%= theme.comments.artalk.placeholder %>',
        site: '<%= config.title %>',
        darkMode: '<%= theme.comments.artalk.darkMode %>',
        pvEl: '#artalk_visitors',
        <% if(!!theme.comments.artalk.imageUploader?.api){ %>
        imgUploader: function(file) {
          let headers = new Headers();
          headers.set('Accept', 'application/json');
          <% if(!!theme.comments.artalk.imageUploader?.token) { %>
            headers.set('Authorization', '<%= theme.comments.artalk.imageUploader?.token %>')
          <% } %>
          let formData = new FormData();
          formData.append('file', file);
          return fetch('<%= theme.comments.artalk.imageUploader?.api %>',{
            method: 'POST',
            body: formData,
            headers: headers
            }).then((resp) => resp.json())
              .then((resp) => resp.<%= theme.comments.artalk.imageUploader?.resp %>)
        },
        <% } %>
        })
      });
  }
  window.addEventListener('DOMContentLoaded', (event) => {
    load_artalk();
  });
</script>